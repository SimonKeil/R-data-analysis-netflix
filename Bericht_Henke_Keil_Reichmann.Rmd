---
title: "R-Projekt"
author: "Márk Reichmann, Simon Keil, Daniel Henke"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	fig.show = "hold",
	message = FALSE,
	warning = FALSE,
	echo = FALSE
)
```
Fragestunde: reicht eine Regression?

_Netflix im zeitlichen Verlauf_
    
- Einleitung: 

    - wie verändert sich das neuere vs ältere material aus Netflix? (release year, not Neflix release Year!) (Daniel)
    
    
- Explorativ:
    
    - Datenbasis umstellen:
        - wir betrachten nur spalten ohne NA werte
        - varaiblen: titel, release_date, Genre(getrennt), land(getrennt)
    
    - anzahl Filme pro Land (balkendiagramm/blaue punkte ?)
    - länder pro film im zeitlichen Verlauf(Daniel)
    - genre (Márk)
    - release Year vs genre Genres (Márk)
    - Jahr vs Anzahl Genre (verfügbar auf Netflix)(Márk)
    - Jahr vs Anzahl Genre (pro film) (neueren Filme nicht vielen Genren zugeordnet) (Márk)

- Methoden
    
    - lineare regression, was ist das? (Simon)
    - falls in 4. was besonderes, dann noch ergänzen
    - pure exzellenz: lineare regression wird durch least squares bestimmt (vgl Bornemann, literatur :))

- Analyse
    
    - y-achsenabschnitt relativ witzloß (Simon)
    - lineare regression (mit residuen, koeffizienten(pro jahr wie viele genres durchschnittlich)) [macht der computer]
    - beschreibung, was wir sehen
    - kritisch hinterfragen, ob netflix spezifisch (Daniel)



## Einleitung

Als 1997 ein kleine Online-Videothek für DVDs in Kalifornien gegründet wurde, war niemanden klar, wie dieses Unternehmen die Welt verändern würde. Jetzt, knapp 25 Jahre später, ist Netflix der größte Video-on-Demand-Anbieter der Welt mit knapp 200 Millionen Abonnenten [1]. Der Streaming-Riese ist heute in mehr als 190 Ländern verfügbar und hat tausende Inhalte in verschieden Sprachen [2].

Hierbei hat Netflix eine große Bandbreite an Filmen und Serien in verschiedensten Genres und aus verschiedenen Jahren. Netflix kauft und produziert Inhalte oft nach Daten, sodass ihr Sortiment keiner wahllosen Zusammenstellung sondern eher einer kuratierten Auswahl gleicht [3].

Dadurch ist die Auswahl, welche Inhalte auf Netflix verfügbar sind und wie diese im Zusammenhang mit Genre, Erscheinungsjahr und weiteren Charakteristika zusammengestellt sind, um einiges spannender. Insbesondere erweist der Vergleich von älteren und neueren Inhalten spannend. Deshalb wollen wir in diesem Bericht der Frage nachgehen: _wie verhalten sich die Inhalte auf Netflix bezüglich ihres Erscheinungsjahr?_



Hierzu haben wir Daten von Kaggle, genauer gesagt von Ashish Gupta, unter https://www.kaggle.com/ashishgup/netflix-rotten-tomatoes-metacritic-imdb. Da es keine offizielle Netflix API gibt, wurden hier Daten von mehreren verschiedenen APIs und Seiten wie "Rotten Tomatoes", "iMDB" und weiteren Quellen zusammengetragen. Zudem hat er eine eigene Metrik, den "Hidden Gem Score", hinzugefügt, der aus den Daten Geheimtipps ermitteln soll. Diesen haben wir aber für unsere Betrachtungen nicht beachtet.

Aufgrund der Heterogenität der Daten sind manche Variablen vertrauenswürdiger als andere. Zum Teil scheinen die Sprachen nicht akurat zu sein, auch Sprachen wie "Latin" werden genannt, die wir in keinem Film auf Netflix finden konnten. Wir vermuten Übersetzungsfehler, können aber den Fehlerursprung nicht eindeutig ermitteln. Zum Teil sind auch bei Zusammenfügen der Daten aus verschiedenen Quellen Fehler aufgetreten. So ist vermutlich bei der Serie "Barberen??????" die Netflix-Serie deutscher Herkunft mit dem iMDB-Eintrag tschechischen Film ???? aus 20?? verbunden wurden. Die Daten sind zum Teil von der Serie, zum Teil vom Film.

Da dies aber (nach unserem Wissen) Einzelfälle sind und es zu diesem Thema kaum bis keine besseren Daten gibt, haben wir trotz dieser Probleme dieses Datenset verwendet.

Teilweise tauchen Filme öfter auf, um diese Duplikate müssen wir uns speziell kümmern.

```{r, message=FALSE, echo=FALSE}
library("tidyverse")
data_basic <- read_csv("Data/data_basic.csv")
data_genre <- read_csv("Data/data_genre.csv")
data_country <- read_csv("Data/data_country.csv")
data_expanded <- read_csv("Data/data_expanded.csv")
```

```{r eval=FALSE, include=FALSE}
raw_data <- read_csv("Data/netflix-rotten-tomatoes-metacritic-imdb.csv")

# dataset to work with throughout the analysis
data_basic <- raw_data %>%
  rename(country = 'Country Availability') %>% 
  # reformat release date to only the year
  mutate(year = as.integer(substr(`Release Date`, 8, 12))) %>% 
  # exclude years with close to no entries
  filter(year > 1965 & year < 2020) %>% 
  select(Genre, year, Title, country) %>%
  drop_na() %>% 
  # remove duplicate Movies
  separate_rows(Genre, sep = ", ") %>%
  separate_rows(country, sep = ",") %>%
  distinct(.keep_all = TRUE) %>%
  group_by(Genre, year, Title) %>%
  summarise(country = paste(country, collapse = ",")) %>%
  group_by(country, year, Title) %>%
  summarise(Genre = paste(Genre, collapse = ", "))
write.csv(data_basic , file = "Data\\data_basic.csv", row.names = FALSE)

# dataset with list of genres separated into individual rows
data_genre <- data_basic %>% 
  separate_rows(Genre, sep = ", ")
write.csv(data_genre , file = "Data\\data_genre.csv", row.names = FALSE)

# dataset with list of countries separated into individual rows
data_country <- data_basic %>%
  separate_rows(country, sep = ",")
write.csv(data_country , file = "Data\\data_country.csv", row.names = FALSE)

# dataset with list of genres and countries separated into individual rows
data_expanded <- data_genre %>%
  separate_rows(country, sep = ",")
write.csv(data_expanded , file = "Data\\data_expanded.csv", row.names = FALSE)
```

```{r eval=FALSE, include=FALSE}
# filme, die doppelt auftauchen:
raw_data %>%
  count(Title, `Release Date`) %>%
  filter(n>1)

data_basic %>%
  count(Title, year) %>%
  filter(n>1)

raw_data %>%
  distinct(Title, `Release Date`, .keep_all = TRUE) %>%
  count(Title, `Release Date`) %>%
  filter(n>1)
```



## Explorative Datenanalyse

*Anmerkung zu Beginn der Analyse:* Wir lesen vor der eigentlichen Auswertung die Daten ein und reduzieren sie auf den Grund-Datenbestand, den wir im Folgenden nutzen wollen: Die Spalten mit dem Titel, Genres, Veröffentlichungsdatum und Länder Verfügbarkeit. Dabei enfernen wir zudem alle Zeilen in denen Angaben fehlen sowie die Filme/Serien mit Veröffentlichungsdatum vor 1965 und nach 2020, da in diesen Jahren nur sehr wenige Einträge vorhanden sind, sodass keine sinvollen Aussagen getroffen werden können.

Zunächst schauen wir uns ein paar allgemeine Zahlen zu unserem (aufgeräumten) Datensatz an. Wir beginnen mit einer statistischen Übersicht zu den Veröffentlichungsjahren:
```{r}
summary(data_basic$year)
```
Wir beobachten zum einen, dass nur noch Werte von 1961 bis 2019 im Datensatz sind (wie oben begründet) und zum anderen, dass sehr viele Filme aus den letzten Jahren stammen, allein 25% aus den Jahren 2017 bis 2019.
Diese Beobachtung sieht man auch, wenn man die Zahl der Filme in dem jeweiligen Veröffentlichungsjahr darstellt. Da der Zusammenhang annährend exponentiell ist, ist die Anzahl im Plot mit einer logarithmischen Skala versehen.
```{r}
data_basic %>% 
  count(year) %>% 
  ggplot(aes(x = year, y = n)) +
  geom_point() +
  scale_y_log10() +
  labs(x = "Veröffentlichungsjahr",
    y = "Anzahl der Filme")
```

Nun schauen wir uns die Länder in unserem Datensatz etwas genauer an. Es gibt 
```{r}
(data_country %>% distinct(country) %>% count())$n
```
Länder in unserem Datensatz. Eine interessante Kenngröße ist, wieviele Filme und Serien es jeweils in den Ländern gibt.

```{r}
data_country %>%
  count(country)%>%
  select(n, country)%>%
  ggplot(aes(x = n, y = reorder(country, n)))+
  geom_point()+
  labs(title = "Anzahl verfügbarer Filme in den Ländern",
       x = "Anzahl der Filme", 
       y = "Land")
```

Man sieht, dass es starke Unterschiede zwischen den einzelnen Ländern gibt und dass keine Gruppenbildung in z.B. Länder mit sehr viel und Ländern mit weniger Filmtiteln zu erkennen ist.

Eine naheliegende Folgerung wäre, dass die Auswahl an Filmen in vielen Ländern ähnlich ist. Das würde bedeuten, dass die meisten Filme in fast allen Ländern verfügbar sind.
Dem ist aber nicht so:
```{r}
data_basic%>% 
  count(Title, year)%>%
  filter(n>1)

data_country %>% 
  count(Title, year)%>%
  filter(n>36)

data_country%>%
  filter(Title == "Cloudy with a Chance of Meatballs")

data_country %>% 
  count(Title, year) %>%
  ggplot(mapping = aes(x = n)) +
  geom_histogram(boundary = 0, bins = 95) +
  labs(title = "wieviele Filme gibt es, die in genau X-vielen Ländern verfügbar sind?",
       x = "Anzahl Länder, in denen die Filme ferfügbar sind",
       y = "Anzahl Filme, die so oft verfügbar sind")
```


__Untersuchung Internationalität vs. Veröffentlichungsjahr__

_Ebenfalls spannend, evtl. als erweiterung zu Simons Idee (~Daniel)_

Netflix wird immer internationaler und hat mehr und mehr Eigenproduktionen. Führt das auf lange Sicht auf ein einheitlicheres Netflix, das weniger regionale Unterschiede hat? Sind die neusten Veröffentlichungen auf Netflix in mehr Ländern verfügbar?


Zunächst schauen wir uns die Film basierend auf ihr ursprüngliches Veröffentlichungsjahr an, wobei wir ähnlich wie oben nur Filme zwischen 1960 und 2021 betrachten. Hier sehen wir eine interessante Kurve, insbesondere wenn wir die in R eingebaute, automatische Glättungskurve einbauen.

```{r}
countriesPerYear <- data_country %>% 
  count(Title, year) %>%
  group_by(year) %>% 
  summarise(number = mean(n)) 

countriesPerYear%>%
  ggplot(aes(x = year, y = number)) +
  geom_point() +
  geom_smooth()+
  labs(title = "Länder pro Film im zeitlichen Verlauf",
       y = "Durchschnittliche Zahl der Länder pro Film",
       x = "Veröffentlichungsjahr des Films")
```

Zuletzt untersuchen wir noch die Genres
```{r}
data_genre %>%
  count(Genre) %>% 
  arrange(n) %>%
  ggplot(aes(x = factor(Genre, levels = Genre), y = n)) +
  geom_bar(stat = 'identity') +
  labs(title = "Ranking der Genres",
    x = "Genre",
    y = "Anzahl der Filme") +  coord_flip()
```

und die Genres im zeitlichen Verlauf: 
```{r}
year_per_genre <- data_genre %>%
  count(year, Genre)
year_genre_total <- data_genre %>% count(year)
left_join(year_per_genre, year_genre_total, by = "year") %>% 
  mutate(prop = n.x/n.y) %>% 
  ggplot(aes(x = year, y = prop, color = Genre)) +
  geom_point() +
  labs(title = "Anzahl der verfügbaren Genres nach Veröffentlichungsjahr",
    x = "Veröffentlichungsjahr",
    y = "Anzahl Genres")
```

Trotz (bzw. sogar wegen) des Overplotting sehen wir klar: Mit zunehmender Jahreszahl gibt es mehr Genres und die einzelnen Genres tendieren dazu einen kleineren Anteil auszumachen, denn die Punkte liegen rechts unten im Plot am dichtesten. Zählen wir die Genres pro Jahr erhalten wir einen annährend linearen Zusammenhang:

```{r}
count_genre_vs_year <- data_genre %>%
  select(Genre, year) %>% 
  group_by(year) %>% 
  distinct() %>% 
  count(year)
count_genre_vs_year %>%
  ggplot(aes(x = year, y = n)) +
  geom_point() +
  labs(title = "Anzahl der Genres in denen Filme verfügbar sind nach Veröffentlichungsjahr",
       x = "Veröffentlichungsjahr",
       y = "Anzahl der Genres")
```

Allerdings wird in unserem Datensatz ein Film i.d.R. mehreren Genres zugeordnet. Liegt der Zusammenhang also eventuell daran, dass neuere Filme einfach mehr unterschiedlichen Genres zugeordnet werden? Um das zu beantworten plotten wir die durchschnittliche Zahl der Genres denen ein Film in einem gegebenen Jahr zugeordnet wird:

```{r}
data_genre %>%
  count(Title, year) %>%
  group_by(year) %>% 
  summarise(number = mean(n)) %>% 
  ggplot(aes(x = year, y = number)) +
  geom_point() +
  labs(title = "Genres pro Film im zeitlichen Verlauf",
       y = "Durchschnittliche Zahl der Genres pro Film",
       x = "Jahr")
```

Anhand des Plots lässt sich diese Vermutung widerlegen, denn die Zahl der Genres ist fast immer zwischen 2.5 und .5, lediglich vor 1980 sieht man etwas stärkere Schwankungen die vermutlich darauf zurückzuführen ist, dass in diesen Jahren die Zahl der Filme die verfügbar sind relativ klein ist. In den Filmen der letzten Jahre ist sogar eher ein Abwärtstrend erkennbar.
 

## Literatur
[1] Statista Research Department (2021). _Netflix: Daten und Fakten zur Erfolgsgeschichte des Streaming-Riesen_. https://de.statista.com/themen/1840/netflix/

[2] Netflix. _Where ist Netflix available?._ https://help.netflix.com/en/node/14164

[3] Netflix. _How does Netflix license TV shows and movies?._ https://help.netflix.com/en/node/4976#:~:text=Netflix%20uses%20a%20variety%20of,shows%20and%20movies%20we%20suggest.