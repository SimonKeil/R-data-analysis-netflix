---
title: "Praesentation"
author: "Márk Reichmann, Simon Keil, Daniel Henke"
date: "6 1 2022"
output:
  beamer_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
	echo = FALSE, message = FALSE)

library("tidyverse")
raw_data <- read_csv("../Data/netflix-rotten-tomatoes-metacritic-imdb.csv")

data <- raw_data %>%
  rename(country = 'Country Availability') %>%
  # reformat release date to only the year
  mutate(year = as.integer(substr(`Release Date`, 8, 12))) %>% 
  # exclude years with close to no entries
  filter(year > 1965 & year < 2020) %>% 
  select(Genre, year, Title, country) %>%
  drop_na()

# unique content + Genre
content_genre <- data %>%
  select(Genre, year, Title) %>% 
  separate_rows(Genre, sep = ", ") %>%
  distinct(.keep_all = TRUE)

# unique content + country
content_country <- data %>%
  select(year, Title, country) %>% 
  separate_rows(country, sep = ",") %>%
  distinct(.keep_all = TRUE)

# dataset with list of genres and countries separated into individual rows
data_expanded <- full_join(content_genre, content_country, by = c("year", "Title")) %>%
  ungroup()

# dataset with list of genres separated into individual rows
data_genre <- data_expanded %>%
  group_by(Genre, year, Title) %>%
  summarise(country = paste(country, collapse = ", ")) %>%
  ungroup()

# dataset with list of countries separated into individual rows
data_country <- data_expanded %>%
  group_by(country, year, Title) %>%
  summarise(Genre = paste(Genre, collapse = ", ")) %>%
  ungroup()

# dataset to work with throughout the analysis
data_basic <- data_genre %>%
  group_by(country, year, Title) %>%
  summarise(Genre = paste(Genre, collapse = ", ")) %>%
  ungroup()
```


# Tibble modifizieren (1)

unser Datensatz (die interessanten Variablen):
\tiny
```{r}
daten <- raw_data %>%
  select(Title, `Release Date`, Genre, `Country Availability`)
daten
```
\normalsize

# Tibble modifizieren (2)

`Release Date` und `Title` sind nur zusammen eindeutig
\tiny
```{r}
raw_data %>%
  select(Title, `Release Date`, `Series or Movie`) %>%
  filter(Title == "Cloudy with a Chance of Meatballs")
```
\normalsize

# Tibble modifizieren (3)

leider gibt es Duplikate:
\tiny
```{r echo=TRUE}
daten %>%
  count(Title, `Release Date`)%>%
  filter(n>1)
```
\normalsize

# Tibble modifizieren (4)

das sind diejenigen Filme, die mehrmals auf Netflix releast wurden
\tiny
```{r}
daten%>%
  filter(Title == "A Perfect Day")
```
\normalsize
Lösung: 
\tiny
```{r echo=TRUE}
daten %>%
  filter(Title == "A Perfect Day") %>%
  select(Title, `Release Date`, Genre, `Country Availability`)%>% 
  separate_rows(`Country Availability`, sep = ",")%>%
  distinct(.keep_all = TRUE)
```
\normalsize

# Tibble modifizieren (5)

selbiges auch mit Genre
\tiny
```{r}
A = daten %>%
  filter(Title == "A Perfect Day") %>%
  select(Title, `Release Date`, `Country Availability`)%>% 
  separate_rows(`Country Availability`, sep = ",")%>%
  distinct(.keep_all = TRUE)

B = daten %>%
  filter(Title == "A Perfect Day") %>%
  select(Title, `Release Date`, Genre)%>% 
  separate_rows(Genre, sep = ", ")%>%
  distinct(.keep_all = TRUE)

A
B
```
\normalsize

diese beiden Tibbles werden jetzt an `Title`, `Release Date` gejoint


# Tibble modifizieren (6)
\tiny
```{r}
full_join(A, B, by = c("Release Date", "Title"))
```
\normalsize

#

```{r}
data_genre %>%
  count(Genre) %>% 
  arrange(n) %>%
  ggplot(aes(x = factor(Genre, levels = Genre), y = n)) +
  geom_bar(stat = 'identity') +
  labs(title = "Ranking der Genres",
    x = "Genre",
    y = "Anzahl der Inhalte") +
  coord_flip() +
  theme_light(20)
```

#

```{r}
year_per_genre <- data_genre %>%
  count(year, Genre)
year_genre_total <- data_genre %>% count(year)
left_join(year_per_genre, year_genre_total, by = "year") %>% 
  mutate(prop = n.x/n.y) %>% 
  ggplot(aes(x = year, y = prop, color = Genre)) +
  geom_point(size = 1) +
  labs(title = "Anteil der verfügbaren Genres nach Veröffentlichungsjahr",
    x = "Veröffentlichungsjahr",
    y = "Anteil der Genres") +
  theme_light(20)
```

#

```{r}
count_genre_vs_year <- data_genre %>%
  select(Genre, year) %>% 
  group_by(year) %>% 
  distinct() %>% 
  count(year)
count_genre_vs_year %>%
  ggplot(aes(x = year, y = n)) +
  geom_point() +
  labs(title = "Anzahl der Genres nach Veröffentlichungsjahr",
       x = "Veröffentlichungsjahr",
       y = "Anzahl der Genres") +
  theme_light(20)
```

#

```{r}
count_genre_vs_year %>%
  ggplot(aes(x = year, y = n)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Anzahl der Genres nach Veröffentlichungsjahr",
       x = "Veröffentlichungsjahr",
       y = "Anzahl der Genres") +
  theme_light(20)
```
